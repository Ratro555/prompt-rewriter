<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PromptMaster - AI Генератор Промтов</title>
    
    <!-- Подключаем Tailwind CSS для стилей -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Настройка Import Map для загрузка React и иконок прямо в браузере -->
    <script type="importmap">
    {
      "imports": {
        "react": "https://esm.sh/react@18.2.0",
        "react-dom/client": "https://esm.sh/react-dom@18.2.0/client",
        "lucide-react": "https://esm.sh/lucide-react@0.263.1"
      }
    }
    </script>
    
    <!-- Подключаем Babel для обработки JSX кода -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
        /* Дополнительные стили для скроллбара, чтобы было красиво */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #1e293b; 
        }
        ::-webkit-scrollbar-thumb {
            background: #475569; 
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #64748b; 
        }
    </style>
</head>
<body class="bg-slate-900">
    <div id="root"></div>

    <!-- Ваш код React -->
    <script type="text/babel" data-type="module">
        import React, { useState, useEffect } from 'react';
        import { createRoot } from 'react-dom/client';
        import { Copy, RefreshCw, Settings, Check, Zap, Globe, Languages, AlertCircle } from 'lucide-react';

        const PromptRewriter = () => {
          const [inputText, setInputText] = useState('');
          const [outputRu, setOutputRu] = useState('');
          const [outputEn, setOutputEn] = useState('');
          const [isLoading, setIsLoading] = useState(false);
          const [apiKey, setApiKey] = useState('');
          const [showSettings, setShowSettings] = useState(false);
          const [copiedRu, setCopiedRu] = useState(false);
          const [copiedEn, setCopiedEn] = useState(false);
          const [error, setError] = useState('');

          const MAX_CHARS = 5000;

          const handleCopy = (text, lang) => {
            if (!text) return;
            // Используем navigator.clipboard для современных браузеров
            if (navigator.clipboard && window.isSecureContext) {
                navigator.clipboard.writeText(text).then(() => {
                    if (lang === 'ru') {
                        setCopiedRu(true);
                        setTimeout(() => setCopiedRu(false), 2000);
                    } else {
                        setCopiedEn(true);
                        setTimeout(() => setCopiedEn(false), 2000);
                    }
                });
            } else {
                // Fallback
                const textArea = document.createElement("textarea");
                textArea.value = text;
                document.body.appendChild(textArea);
                textArea.select();
                try {
                    document.execCommand('copy');
                    if (lang === 'ru') {
                        setCopiedRu(true);
                        setTimeout(() => setCopiedRu(false), 2000);
                    } else {
                        setCopiedEn(true);
                        setTimeout(() => setCopiedEn(false), 2000);
                    }
                } catch (err) {
                    console.error('Failed to copy', err);
                }
                document.body.removeChild(textArea);
            }
          };

          const handleGenerate = async () => {
            if (!inputText.trim()) {
              setError('Пожалуйста, введите текст промта.');
              return;
            }
            
            if (inputText.length > MAX_CHARS) {
              setError(`Текст слишком длинный. Максимум ${MAX_CHARS} символов.`);
              return;
            }

            setError('');
            setIsLoading(true);
            setOutputRu('');
            setOutputEn('');

            try {
              if (apiKey) {
                await generateWithGemini(inputText);
              } else {
                await mockGenerate(inputText);
              }
            } catch (err) {
              setError('Ошибка генерации. Проверьте API ключ или интернет-соединение.');
              console.error(err);
            } finally {
              setIsLoading(false);
            }
          };

          const mockGenerate = async (text) => {
            return new Promise(resolve => {
              setTimeout(() => {
                setOutputRu(`[ДЕМО РЕЖИМ - Введите API ключ для реального ИИ]\n\nПерефразированная версия:\n${text.split(' ').reverse().join(' ')} (Слова переставлены для демонстрации интерфейса). \n\nВ реальном режиме здесь будет текст с синонимами и сохраненной логикой.`);
                setOutputEn(`[DEMO MODE - Enter API Key for real AI]\n\nRewritten version:\n${text} \n\n(This is a placeholder translation. Real AI would paraphrase this efficiently).`);
                resolve();
              }, 1500);
            });
          };

          const generateWithGemini = async (text) => {
            const prompt = `
              You are a professional prompt engineer and copywriter. 
              Task: Rewrite the following prompt in two versions preserving the exact logic and meaning, but using synonyms and professional phrasing.
              
              Input text: "${text}"
              
              Requirements:
              1. Russian Version: Rewrite in Russian using rich vocabulary and synonyms.
              2. English Version: Translate and rewrite in English using professional vocabulary.
              
              Output MUST be a valid JSON object without markdown formatting:
              {
                "ru": "string (russian version)",
                "en": "string (english version)"
              }
            `;

            try {
              const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`, {
                method: 'POST',
                headers: {
                  'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                  contents: [{ parts: [{ text: prompt }] }]
                })
              });

              const data = await response.json();
              
              if (data.error) {
                throw new Error(data.error.message);
              }

              const rawText = data.candidates[0].content.parts[0].text;
              const jsonString = rawText.replace(/```json|```/g, '').trim();
              const result = JSON.parse(jsonString);

              setOutputRu(result.ru);
              setOutputEn(result.en);

            } catch (error) {
              console.error("API Error:", error);
              throw error;
            }
          };

          return (
            <div className="min-h-screen bg-slate-900 text-slate-100 font-sans selection:bg-indigo-500 selection:text-white">
              <header className="bg-slate-800 border-b border-slate-700 sticky top-0 z-10">
                <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 h-16 flex items-center justify-between">
                  <div className="flex items-center gap-2">
                    <Zap className="text-yellow-400 h-6 w-6" />
                    <h1 className="text-xl font-bold bg-gradient-to-r from-yellow-400 to-orange-500 bg-clip-text text-transparent">
                      PromptMaster
                    </h1>
                    <span className="hidden sm:inline-block text-xs bg-slate-700 text-slate-300 px-2 py-0.5 rounded-full ml-2">
                      AI Rewriter
                    </span>
                  </div>
                  
                  <button 
                    onClick={() => setShowSettings(!showSettings)}
                    className={`p-2 rounded-lg transition-colors ${showSettings ? 'bg-indigo-600 text-white' : 'hover:bg-slate-700 text-slate-400'}`}
                    title="Настройки API"
                  >
                    <Settings className="h-5 w-5" />
                  </button>
                </div>
              </header>

              {showSettings && (
                <div className="bg-slate-800 border-b border-slate-700 p-4 animate-in slide-in-from-top-2 duration-200">
                  <div className="max-w-3xl mx-auto">
                    <label className="block text-sm font-medium text-slate-300 mb-2">
                      Google Gemini API Key (для реальной генерации)
                    </label>
                    <input 
                      type="password" 
                      value={apiKey}
                      onChange={(e) => setApiKey(e.target.value)}
                      placeholder="Вставьте ваш API ключ здесь..."
                      className="w-full bg-slate-900 border border-slate-600 rounded-md p-2 text-slate-200 focus:ring-2 focus:ring-indigo-500 focus:outline-none placeholder-slate-600"
                    />
                    <p className="text-xs text-slate-500 mt-2">
                      Ключ хранится только локально в браузере. Без ключа работает демо-режим.
                    </p>
                  </div>
                </div>
              )}

              <main className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
                <section className="mb-8">
                  <div className="flex justify-between items-end mb-2">
                    <label className="text-sm font-semibold text-slate-300 flex items-center gap-2">
                      <span className="w-2 h-2 rounded-full bg-indigo-500"></span>
                      Исходный Промт
                    </label>
                    <span className={`text-xs ${inputText.length > MAX_CHARS ? 'text-red-400' : 'text-slate-500'}`}>
                      {inputText.length} / {MAX_CHARS}
                    </span>
                  </div>
                  
                  <div className="relative group">
                    <textarea
                      value={inputText}
                      onChange={(e) => setInputText(e.target.value)}
                      placeholder="Вставьте сюда ваш текст (промт), который нужно переписать синонимами..."
                      className="w-full h-48 bg-slate-800 border-2 border-slate-700 rounded-xl p-4 text-slate-200 focus:border-indigo-500 focus:ring-0 transition-colors resize-y text-lg leading-relaxed placeholder-slate-600"
                    />
                    {inputText && (
                       <button 
                         onClick={() => setInputText('')}
                         className="absolute top-3 right-3 text-slate-500 hover:text-slate-300 text-xs bg-slate-700/50 px-2 py-1 rounded"
                       >
                         Очистить
                       </button>
                    )}
                  </div>

                  {error && (
                    <div className="mt-3 flex items-center gap-2 text-red-400 text-sm bg-red-400/10 p-3 rounded-lg border border-red-400/20">
                      <AlertCircle className="h-4 w-4" />
                      {error}
                    </div>
                  )}

                  <div className="mt-6 flex justify-center">
                    <button
                      onClick={handleGenerate}
                      disabled={isLoading || !inputText}
                      className={`
                        flex items-center gap-2 px-8 py-4 rounded-full font-bold text-lg shadow-lg transition-all transform active:scale-95
                        ${isLoading 
                          ? 'bg-slate-700 text-slate-400 cursor-not-allowed' 
                          : 'bg-indigo-600 hover:bg-indigo-500 text-white hover:shadow-indigo-500/25'
                        }
                      `}
                    >
                      {isLoading ? (
                        <>
                          <RefreshCw className="h-5 w-5 animate-spin" />
                          Переписываем...
                        </>
                      ) : (
                        <>
                          <Zap className="h-5 w-5" />
                          Сгенерировать Варианты
                        </>
                      )}
                    </button>
                  </div>
                </section>

                <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                  <div className="flex flex-col h-full">
                    <div className="flex items-center justify-between mb-3 bg-slate-800/50 p-2 rounded-t-lg border-b border-indigo-500/30">
                      <div className="flex items-center gap-2 text-indigo-400 font-medium">
                        <Languages className="h-4 w-4" />
                        Русский (Синонимы)
                      </div>
                      <button
                        onClick={() => handleCopy(outputRu, 'ru')}
                        className="text-slate-400 hover:text-white transition-colors p-1"
                        disabled={!outputRu}
                      >
                        {copiedRu ? <Check className="h-4 w-4 text-green-400" /> : <Copy className="h-4 w-4" />}
                      </button>
                    </div>
                    <div className="relative flex-grow">
                      <div className="absolute inset-0 bg-slate-800 rounded-b-lg border border-slate-700 p-4 overflow-auto">
                        {outputRu ? (
                           <p className="whitespace-pre-wrap text-slate-200 leading-relaxed">{outputRu}</p>
                        ) : (
                          <div className="h-full flex flex-col items-center justify-center text-slate-600">
                            <span className="text-4xl mb-2 opacity-20">RU</span>
                            <p className="text-sm">Результат на русском появится здесь</p>
                          </div>
                        )}
                      </div>
                      <div className="invisible h-64 whitespace-pre-wrap p-4">{outputRu || 'placeholder'}</div> 
                    </div>
                  </div>

                  <div className="flex flex-col h-full">
                    <div className="flex items-center justify-between mb-3 bg-slate-800/50 p-2 rounded-t-lg border-b border-emerald-500/30">
                      <div className="flex items-center gap-2 text-emerald-400 font-medium">
                        <Globe className="h-4 w-4" />
                        English (Translation)
                      </div>
                      <button
                        onClick={() => handleCopy(outputEn, 'en')}
                        className="text-slate-400 hover:text-white transition-colors p-1"
                        disabled={!outputEn}
                      >
                        {copiedEn ? <Check className="h-4 w-4 text-green-400" /> : <Copy className="h-4 w-4" />}
                      </button>
                    </div>
                    <div className="relative flex-grow">
                       <div className="absolute inset-0 bg-slate-800 rounded-b-lg border border-slate-700 p-4 overflow-auto">
                        {outputEn ? (
                           <p className="whitespace-pre-wrap text-slate-200 leading-relaxed font-mono text-sm">{outputEn}</p>
                        ) : (
                          <div className="h-full flex flex-col items-center justify-center text-slate-600">
                            <span className="text-4xl mb-2 opacity-20">EN</span>
                            <p className="text-sm">English result will appear here</p>
                          </div>
                        )}
                      </div>
                      <div className="invisible h-64 whitespace-pre-wrap p-4">{outputEn || 'placeholder'}</div>
                    </div>
                  </div>

                </div>
              </main>
            </div>
          );
        };

        const root = createRoot(document.getElementById('root'));
        root.render(<PromptRewriter />);
    </script>
</body>
</html>